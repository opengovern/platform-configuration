Description: Allows users to query IAM Roles to gain insights into their permissions,
  trust policies, and associated metadata.
ID: aws_iam_role_8
IntegrationType:
- aws_cloud_account
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables: []
  Parameters: []
  PrimaryTable: null
  QueryToExecute: "select\n  maintenance.name,\n  admin.name,\n  jsonb_pretty(maintenance_stmt),\n\
    \  jsonb_pretty(admin_stmt)\nfrom\n  -- use the account to get the organization_id\n\
    \  aws_account as a,\n  -- check any role as the \"maintenance-role\"\n  aws_iam_role\
    \ as maintenance,\n  -- Combine via join with any role as the \"admin-role\"\n\
    \  aws_iam_role as admin,\n  jsonb_array_elements(maintenance.assume_role_policy_std\
    \ -> 'Statement') as maintenance_stmt,\n  jsonb_array_elements(admin.assume_role_policy_std\
    \ -> 'Statement') as admin_stmt\nwhere\n  -- maintenance role can be assumed by\
    \ any AWS principal\n  maintenance_stmt -> 'Principal' -> 'AWS' ? '*'\n  -- maintenance\
    \ role principal must be in same account\n  and maintenance_stmt -> 'Condition'\
    \ -> 'StringEquals' -> 'aws:principalorgid' ? a.organization_id\n  -- admin role\
    \ specifically allow maintenance role\n  and admin_stmt -> 'Principal' -> 'AWS'\
    \ ? maintenance.arn;"
Tags:
  cloud_asset_management:
  - 'true'
  cloud_identity_security:
  - 'true'
  cloud_provider:
  - aws
  cloud_service:
  - IAM
Title: Find IAM Roles, Insights into Permissions and Policies in AWS

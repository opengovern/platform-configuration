Description: To enable HTTPS connections to your website or application in AWS, you need an SSL/TLS server certificate. You can use ACM or IAM to store and deploy server certificates. Use IAM as a certificate manager only when you must support HTTPS connections in a region that is not supported by ACM. IAM securely encrypts your private keys and stores the encrypted version in IAM SSL certificate storage. IAM supports deploying server certificates in all regions, but you must obtain your certificate from an external provider for use with AWS. You cannot upload an ACM certificate to IAM. Additionally, you cannot manage your certificates from the IAM Console.
ID: aws_iam_server_certificate_not_expired
IntegrationType:
  - aws_cloud_account
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables:
    - aws_iam_server_certificate
  Parameters: []
  PrimaryTable: aws_iam_server_certificate
  QueryToExecute: |
    SELECT
      arn AS resource,
      og_account_id AS og_account_id,
      og_resource_id AS og_resource_id,
      CASE 
        WHEN expiration < (current_date - INTERVAL '1' SECOND) THEN 'alarm'
        ELSE 'ok'
      END AS status,
      CASE 
        WHEN expiration < (current_date - INTERVAL '1' SECOND) THEN
          name || ' expired ' || TO_CHAR(expiration, 'DD-Mon-YYYY') || '.'
        ELSE
          name || ' valid until ' || TO_CHAR(expiration, 'DD-Mon-YYYY') || '.'
      END AS reason,
      account_id
    FROM
      aws_iam_server_certificate;
Severity: medium
Tags:
  category:
    - Compliance
  cis:
    - "true"
  cis_item_id:
    - "1.19"
  cis_level:
    - "1"
  cis_section_id:
    - "1"
  cis_type:
    - automated
  cis_version:
    - v1.3.0
  plugin:
    - aws
  service:
    - AWS/IAM
Title: Ensure that all the expired SSL/TLS certificates stored in AWS IAM are removed
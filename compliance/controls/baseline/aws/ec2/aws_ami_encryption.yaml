ID: aws_ami_encryption
Title: "AWS AMI Encryption"
Description: "Ensure that your existing AMIs are encrypted to meet security and compliance requirements."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "SELECT \n  name as resource,\n  og_resource_id,\n  og_account_id,\n  CASE\n    WHEN EXISTS (\n      SELECT 1 FROM jsonb_array_elements(block_device_mappings) AS b WHERE (b -> 'Ebs' ->> 'Encrypted')::bool = False\n    ) THEN 'alarm'\n    ELSE 'ok'\n  END AS status,\n  CASE\n    WHEN EXISTS (\n      SELECT 1 FROM jsonb_array_elements(block_device_mappings) AS b WHERE (b -> 'Ebs' ->> 'Encrypted')::bool = False\n    ) THEN name || ' has unencrypted data' \n    ELSE name || ' data is encrypted'\n  END AS reason,\n  region,\n  account_id\nFROM \n  aws_ec2_ami\n"
  PrimaryTable: aws_ec2_ami
  ListOfTables:
    - aws_ec2_ami
  Parameters: []
Severity: high
Tags:
  platform_score_cloud_service_name:
    - AWS EC2
  platform_score_use_case:
    - Unencrypted Storage
  score_service_name:
    - AWS EC2
  score_tags:
    - Unencrypted Storage
IntegrationTypeName:
  - aws_cloud

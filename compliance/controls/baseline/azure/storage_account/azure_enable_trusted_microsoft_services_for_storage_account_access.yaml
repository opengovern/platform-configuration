Description: Allow Trusted Microsoft Services to access your Azure Storage account resources.
ID: azure_enable_trusted_microsoft_services_for_storage_account_access
IntegrationType:
  - azure_subscription
Query:
  Engine: odysseus-v0.0.1
  ListOfTables:
    - azure_storage_account
    - azure_subscription
  Parameters: []
  PrimaryTable: azure_storage_account
  QueryToExecute: |
    SELECT
      sa.id AS resource,
      sa.og_account_id,
      sa.og_resource_id,
      CASE
        WHEN network_rule_bypass = 'None' THEN 'alarm'
        ELSE 'ok'
      END AS status,
      CASE
        WHEN network_rule_bypass = 'None' THEN 'Trusted Microsoft services are not allowed to access the selected Azure Storage account'
        ELSE 'Trusted Microsoft services are allowed to access the selected Azure Storage account'
      END AS reason,
      sa.resource_group,
      display_name AS subscription
    FROM
      azure_storage_account AS sa,
      azure_subscription AS sub
    WHERE
      sub.subscription_id = sa.subscription_id
Severity: medium
Tags:
  platform_score_cloud_service_name:
    - Azure Storage Accounts
  score_service_name:
    - Azure Storage Accounts
Title: Enable Trusted Microsoft Services for Storage Account Access
ID: aws_ecs_service_not_publicly_accessible
Title: "AWS ECS services should not have public IP addresses assigned to them automatically"
Description: "This control checks whether AWS ECS services are configured to automatically assign public IP addresses. This control fails if AssignPublicIP is enabled."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "with service_awsvpc_mode_task_definition as (\n  select\n    a.service_name as service_name,\n    b.task_definition_arn as task_definition\n  from\n    aws_ecs_service as a\n    left join aws_ecs_task_definition as b on a.task_definition = b.task_definition_arn\n  where\n    b.network_mode = 'awsvpc'\n)\nselect\n  a.arn as resource,\n  a.og_account_id as og_account_id,\n  a.og_resource_id as og_resource_id,\n  case\n    when b.service_name is null then 'skip'\n    when network_configuration -> 'AwsvpcConfiguration' ->> 'AssignPublicIp' = 'DISABLED' then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when b.service_name is null then a.title || ' task definition not host network mode.'\n    when network_configuration -> 'AwsvpcConfiguration' ->> 'AssignPublicIp' = 'DISABLED' then a.title || ' not publicly accessible.'\n    else a.title || ' publicly accessible.'\n  end as reason\n  \n  , region, account_id\nfrom\n  aws_ecs_service as a\n  left join service_awsvpc_mode_task_definition as b on a.service_name = b.service_name;\n"
  PrimaryTable: aws_ecs_service
  ListOfTables:
    - aws_ecs_service
    - aws_ecs_task_definition
  Parameters: []
Severity: high
Tags:
  aws_foundational_security:
    - "true"
  category:
    - Compliance
  foundational_security_category:
    - resources_not_publicly_accessible
  foundational_security_item_id:
    - ecs_2
  plugin:
    - aws
  service:
    - AWS/ECS
IntegrationTypeName:
  - aws_cloud_account

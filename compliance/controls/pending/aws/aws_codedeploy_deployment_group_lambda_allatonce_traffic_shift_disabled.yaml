ID: aws_codedeploy_deployment_group_lambda_allatonce_traffic_shift_disabled
Title: "Codedeploy deployment groups lambda allatonce traffic shift should be disabled"
Description: "This control checks if the deployment group for Lambda Compute Platform is not using the default deployment configuration. The rule is non-compliant if the deployment group is using the deployment configuration 'CodeDeployDefault.LambdaAllAtOnce'."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "with codedeployment_groups as (\n  select\n    arn,\n    application_name,\n    deployment_config_name,\n    tags,\n    title,\n    region,\n    account_id,\n    _ctx\n  from\n    aws_codedeploy_deployment_group\n  group by\n    arn,\n    application_name,\n    deployment_config_name,\n    tags,\n    title,\n    region,\n    account_id,\n    _ctx\n),\ncodedeploy_apps as (\n  select\n    application_name,\n    compute_platform,\n    region,\n    account_id,\n    title\n  from\n    aws_codedeploy_app\n  group by\n    application_name,\n    compute_platform,\n    region,\n    account_id,\n    title\n)\nselect\n  g.arn as resource,\n  case\n    when a.compute_platform <> 'Lambda' then 'skip'\n    when deployment_config_name = 'CodeDeployDefault.LambdaAllAtOnce' then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when a.compute_platform <> 'Lambda' then g.title || ' using ' ||  a.compute_platform || ' compute platform.'\n    else g.title || ' using '|| deployment_config_name || ' deployment config.'\n  end as reason\n  \n  \nfrom\n  codedeployment_groups as g,\n  codedeploy_apps as a\nwhere\n  g.application_name = a.application_name;\n"
  PrimaryTable: ""
  ListOfTables: []
  Parameters: []
Severity: low
Tags: {}
Integration_Type_Name:
  - aws_cloud

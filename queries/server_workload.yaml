Description: List Cloud VM Workloads for AWS and Azure
ID: server_workload
IntegrationTypeName:
- aws_cloud_account
- azure_subscription
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables: []
  Parameters: []
  PrimaryTable: null
  QueryToExecute: "select c.name as cloud_account_name, c.id as _discovered_provider_id,\
    \ t.* from (\n(select \n  'AWS' as provider, \n  r.name as vm_name, \n  r.region\
    \ as location, \n  jsonb_path_query(r.description, '$.Instance.InstanceType')\
    \ as instance_size,\n  jsonb_path_query(r.description, '$.Instance.NetworkInterfaces[*].PrivateIpAddress')\
    \ as private_ip,\n  jsonb_path_query(r.description, '$.Instance.PlatformDetails')\
    \ as platform,\n  jsonb_path_query(r.description, '$.InstanceStatus.InstanceState.Name')\
    \ as state,\n  jsonb_path_query(r.description, '$.Instance.Tags') as _tags,\n\
    \  r.connection_id as _og_connection_id,\n  r.resource_id as _resource_id,\n \
    \ r.resource_type as _resource_type,\n  r.created_at as _last_discovered\nfrom\
    \ \n  platform_resources r\nwhere \n  resource_type = 'aws::ec2::instance') \n\nunion\
    \ \n\n(select \n  'Azure' as provider, \n  r.name as vm_name, \n  r.region as\
    \ location, \n  jsonb_path_query(r.description, '$.VirtualMachine.Properties.HardwareProfile.VMSize')\
    \ as instance_size,\n  jsonb_path_query(r.description, '$.InterfaceIPConfigurations[*].Properties.PrivateIPAddress')\
    \ as private_ip,\n  jsonb_path_query(r.description, '$.VirtualMachineInstanceView.OSName')\
    \ as platform,\n  jsonb_path_query(r.description, '$.VirtualMachineInstanceView.Statuses')\
    \ as state,\n  jsonb_path_query(r.description, '$.VirtualMachine.Tags') as _tags,\n\
    \  r.connection_id as _og_connection_id,\n  r.resource_id as _resource_id,\n \
    \ r.resource_type as _resource_type,\n  r.created_at as _last_discovered\nfrom\
    \ \n  platform_resources r \nwhere \n  resource_type = 'microsoft.compute/virtualmachines')\n\
    \n) as t inner join og_connections c on t._og_connection_id = c.og_id "
Tags:
  cloud_asset_management:
  - 'true'
  cloud_provider:
  - aws
  - azure
  cloud_service:
  - EC2
  - Virtual Machines
Title: List Cloud VM Workloads for AWS and Azure

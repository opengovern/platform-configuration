Description: This control checks whether RDS DB snapshots are encrypted. This control is intended for RDS DB instances. However, it can also generate findings for snapshots of Aurora DB instances, Neptune DB instances, and Amazon DocumentDB clusters. If these findings are not useful, then you can suppress them.
ID: aws_foundational_security_rds_4
IntegrationType:
  - aws_cloud_account
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables: []
  Parameters: []
  PrimaryTable: ""
  QueryToExecute: |
    (
    SELECT
      arn AS resource,
      CASE
        WHEN storage_encrypted THEN 'ok'
        ELSE 'alarm'
      END AS status,
      CASE
        WHEN storage_encrypted THEN title || ' encrypted at rest.'
        ELSE title || ' not encrypted at rest.'
      END AS reason
    FROM
      aws_rds_db_cluster_snapshot
    )
    UNION
    (
    SELECT
      arn AS resource,
      CASE
        WHEN encrypted THEN 'ok'
        ELSE 'alarm'
      END AS status,
      CASE
        WHEN encrypted THEN title || ' encrypted at rest.'
        ELSE title || ' not encrypted at rest.'
      END AS reason
    FROM
      aws_rds_db_snapshot
    );
Severity: medium
Tags: {}
Title: 4 RDS cluster snapshots and database snapshots should be encrypted at rest
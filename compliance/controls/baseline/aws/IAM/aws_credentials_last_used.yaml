ID: aws_credentials_last_used
Title: "Credentials Last Used"
Description: "Ensure that unused AWS IAM credentials are decommissioned to follow security best practices."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "SELECT \n    user_name, \n    og_account_id,\n    og_resource_id,\n    CASE \n      WHEN not password_enabled::bool THEN 'skip'\n      WHEN password_last_used < NOW() - INTERVAL '90 days' THEN 'alarm' \n      ELSE 'ok'\n    END AS status,\n    CASE\n      WHEN not password_enabled::bool THEN 'password is disabled'\n      WHEN password_last_used < NOW() - INTERVAL '90 days' THEN 'the password is considered unused and its better to be removed'\n      ELSE 'the password is being used'\n    END AS reason,\n    region, \n    account_id\nFROM aws_iam_credential_report\n\nUNION ALL\n\nSELECT \n    user_name, \n    og_account_id,\n    og_resource_id,\n    CASE \n      WHEN not access_key_1_active::bool THEN 'skip'\n      WHEN access_key_1_last_used_date < NOW() - INTERVAL '90 days' THEN 'alarm' \n      ELSE 'ok'\n    END AS status,\n    CASE\n      WHEN not access_key_1_active::bool THEN 'access key 1 is disabled'\n      WHEN access_key_1_last_used_date < NOW() - INTERVAL '90 days' THEN 'access key 1 is considered unused and its better to be removed'\n      ELSE 'access key 1 is being used'\n    END AS reason,\n    region, \n    account_id\nFROM aws_iam_credential_report\n\nUNION ALL\n\nSELECT \n    user_name, \n    og_account_id,\n    og_resource_id,\n    CASE \n      WHEN not access_key_2_active::bool THEN 'skip'\n      WHEN access_key_2_last_used_date < NOW() - INTERVAL '90 days' THEN 'alarm' \n      ELSE 'ok'\n    END AS status,\n    CASE\n      WHEN not access_key_2_active::bool THEN 'access key 2 is disabled'\n      WHEN access_key_2_last_used_date < NOW() - INTERVAL '90 days' THEN 'access key 2 is considered unused and its better to be removed'\n      ELSE 'access key 2 is being used'\n    END AS reason,\n    region, \n    account_id\nFROM aws_iam_credential_report;\n"
  PrimaryTable: aws_iam_credential_report
  ListOfTables:
    - aws_iam_credential_report
  Parameters: []
Severity: high
Tags:
  platform_score_cloud_service_name:
    - AWS Identity and Access Management (IAM)
  platform_score_use_case:
    - Insecure Keys
  score_service_name:
    - AWS Identity and Access Management (IAM)
  score_tags:
    - Insecure Keys
Integration_Type_Name:
  - aws_cloud

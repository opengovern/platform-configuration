ID: azure_check_for_azure_key_vault_keys_expiration_date
Title: "Check for Azure Key Vault Keys Expiration Date"
Description: "Ensure that your Azure Key Vault encryption keys are renewed prior to their expiration date."
Query:
  Engine: odysseus-v0.0.1
  QueryToExecute: "select\n  name as resource,\n  k.og_resource_id,\n  k.og_account_id,\n  case\n    when expires_at is null then 'skip'\n    when '{{.azureKeyVaultKeyExpirationDateDays}}' = '' then\n      case \n        when expires_at - now() > '30 days'::interval then 'ok'\n        else 'alarm'\n      end\n    else\n      case\n        when expires_at - now() > '{{.azureKeyVaultKeyExpirationDateDays}} days'::interval then 'ok'\n        else 'alarm'\n      end\n  end as status,\n  case\n    when expires_at is null then 'expires at is not specified'\n    when expires_at < now() then 'key has been expired'\n    when '{{.azureKeyVaultKeyExpirationDateDays}}' = '' then\n      case\n        when expires_at - now() > '30 days'::interval then 'key does not expire soon'\n        else 'key expires soon'\n      end\n    else\n      case\n        when expires_at - now() > '{{.azureKeyVaultKeyExpirationDateDays}} days'::interval then 'key does not expire soon'\n        else 'key expires soon'\n      end\n  end as reason,\n  resource_group as resource_group,\n  sub.display_name as subscription\nfrom\n  azure_key_vault_key as k\n  left join azure_subscription as sub on k.subscription_id = sub.subscription_id\n"
  PrimaryTable: azure_key_vault_key
  ListOfTables:
    - azure_key_vault_key
    - azure_subscription
  Parameters:
    - Key: azureKeyVaultKeyExpirationDateDays
      Required: true
Severity: medium
Tags:
  platform_score_cloud_service_name:
    - Azure KeyVault
  platform_score_use_case:
    - Problem Identities
  score_service_name:
    - Azure KeyVault
  score_tags:
    - Problem Identities
Integration_Type_Name:
  - azure_subscription

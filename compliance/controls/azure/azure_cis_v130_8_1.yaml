ID: azure_cis_v130_8_1
Title: "8.1 Ensure that the expiration date is set on all keys"
Description: "Ensure that all keys in Azure Key Vault have an expiration time set."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "select\n  kvk.id as resource,\n  kvk.og_account_id as og_account_id,\n  kvk.og_resource_id as og_resource_id,\n  case\n    when enabled and expires_at is null then 'alarm'\n    else 'ok'\n  end as status,\n  vault_name || ' key ' || name ||\n  case\n    when enabled and expires_at is null then ' expiration date not set.'\n    when not enabled then ' disabled.'\n    else ' expiration date set to ' || to_char(expires_at, 'DD-Mon-YYYY') || '.'\n  end as reason\n  \n  \n  \nfrom\n  azure_key_vault_key kvk,\n  azure_subscription sub\nwhere\n  sub.subscription_id = kvk.subscription_id;"
  PrimaryTable: azure_key_vault_key
  ListOfTables:
    - azure_key_vault_key
    - azure_subscription
  Parameters: []
Severity: low
Tags: {}
IntegrationType:
  - azure_subscription

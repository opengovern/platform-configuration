ID: aws_vpc_route_table_restrict_public_access_to_igw
Title: "VPC route table should restrict public access to IGW"
Description: "Ensure that there are public routes in the route table to an Internet Gateway (IGW). The rule is non-compliant if a route to an IGW has a destination CIDR block of '0.0.0.0/0' or '::/0'."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "with route_with_public_access as (\n  select\n    route_table_id,\n    count(*) as num\n  from\n    aws_vpc_route_table,\n    jsonb_array_elements(routes) as r\n  where\n    ( r ->> 'DestinationCidrBlock' = '0.0.0.0/0'\n      or r ->> 'DestinationCidrBlock' = '::/0'\n    )\n    and r ->> 'GatewayId' like 'igw%'\n  group by\n    route_table_id\n)\nselect\n  a.route_table_id as resource,\n  a.og_account_id as og_account_id,\n  a.og_resource_id as og_resource_id,\n  case\n    when b.route_table_id is null then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when b.route_table_id is null then a.title || ' does not have public routes to an Internet Gateway (IGW)'\n    else a.title || ' contains ' || b.num || ' rule(s) which have public routes to an Internet Gateway (IGW)'\n  end as reason\n  \n  , region, account_id\nfrom\n  aws_vpc_route_table as a\n  left join route_with_public_access as b on b.route_table_id = a.route_table_id;\n"
  PrimaryTable: aws_vpc_route_table
  ListOfTables:
    - aws_vpc_route_table
  Parameters: []
Severity: high
Tags:
  category:
    - Compliance
  cisa_cyber_essentials:
    - "true"
  fedramp_low_rev_4:
    - "true"
  fedramp_moderate_rev_4:
    - "true"
  ffiec:
    - "true"
  gxp_21_cfr_part_11:
    - "true"
  hipaa_final_omnibus_security_rule_2013:
    - "true"
  nist_800_171_rev_2:
    - "true"
  nist_800_53_rev_5:
    - "true"
  nist_csf:
    - "true"
  pci_dss_v321:
    - "true"
  plugin:
    - aws
  rbi_cyber_security:
    - "true"
  service:
    - AWS/VPC
IntegrationTypeName:
  - aws_cloud_account

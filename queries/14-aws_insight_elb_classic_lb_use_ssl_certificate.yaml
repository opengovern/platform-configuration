Description: List all Load Balancers with out SSL
ID: aws_insight_elb_classic_lb_use_ssl_certificate
IntegrationType:
- aws_cloud_account
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables:
  - aws_ec2_classic_load_balancer
  Parameters: []
  PrimaryTable: aws_ec2_classic_load_balancer
  QueryToExecute: "with detailed_classic_listeners as (\n  select\n    name\n  from\n\
    \    aws_ec2_classic_load_balancer,\n    jsonb_array_elements(listener_descriptions)\
    \ as listener_description\n  where\n    listener_description -> 'Listener' ->>\
    \ 'Protocol' in ('HTTPS', 'SSL', 'TLS')\n    and listener_description -> 'Listener'\
    \ ->> 'SSLCertificateId' like 'arn:aws:acm%'\n)\nselect\n  -- Required Columns\n\
    \  'arn:' || a.partition || ':elasticloadbalancing:' || a.region || ':' || a.account_id\
    \ || ':loadbalancer/' || a.name as resource,\n  case\n    when a.listener_descriptions\
    \ is null then 'skip'\n    when b.name is not null then 'alarm'\n    else 'ok'\n\
    \  end as status,\n  case\n    when a.listener_descriptions is null then a.title\
    \ || ' has no listener.'\n    when b.name is not null then a.title || ' does not\
    \ use certificates provided by ACM.'\n    else a.title || ' uses certificates\
    \ provided by ACM.'\n  end as reason,\n  -- Additional Dimensions\n  region,\n\
    \  account_id, og_account_id, og_resource_id\nfrom\n  aws_ec2_classic_load_balancer\
    \ as a\n  left join detailed_classic_listeners as b on a.name = b.name;"
Tags:
  category:
  - Security
  - Technical Debt
Title: Load Balancers with no SSL

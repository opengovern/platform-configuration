Description: AWS CloudShell is a convenient way of running CLI commands against AWS services; a managed IAM policy ('AWSCloudShellFullAccess') provides full access to CloudShell, which allows file upload and download capability between a user's local system and the CloudShell environment. Within the CloudShell environment a user has sudo permissions, and can access the internet. So it is feasible to install file transfer software (for example) and move data from CloudShell to external internet servers.
ID: aws_cis_v200_1_22
IntegrationType:
  - aws_cloud_account
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables: []
  Parameters: []
  PrimaryTable: ""
  QueryToExecute: |
    SELECT
      arn AS resource,
      CASE
        WHEN attached_policy_arns @> '[\"arn:aws:iam::aws:policy/AWSCloudShellFullAccess\"]' THEN 'alarm'
        ELSE 'ok'
      END status,
      CASE
        WHEN attached_policy_arns @> '[\"arn:aws:iam::aws:policy/AWSCloudShellFullAccess\"]' THEN 'User ' || title || ' has access to AWSCloudShellFullAccess.'
        ELSE 'User ' || title || ' access to AWSCloudShellFullAccess is restricted.'
      END AS reason
    FROM
      aws_iam_user
    UNION
    SELECT
      arn AS resource,
      CASE
        WHEN attached_policy_arns @> '[\"arn:aws:iam::aws:policy/AWSCloudShellFullAccess\"]' THEN 'alarm'
        ELSE 'ok'
      END status,
      CASE
        WHEN attached_policy_arns @> '[\"arn:aws:iam::aws:policy/AWSCloudShellFullAccess\"]' THEN 'Role ' || title || ' has access to AWSCloudShellFullAccess.'
        ELSE 'Role ' || title || ' access to AWSCloudShellFullAccess is restricted.'
      END AS reason
    FROM
      aws_iam_role
    UNION
    SELECT
      arn AS resource,
      CASE
        WHEN attached_policy_arns @> '[\"arn:aws:iam::aws:policy/AWSCloudShellFullAccess\"]' THEN 'alarm'
        ELSE 'ok'
      END status,
      CASE
        WHEN attached_policy_arns @> '[\"arn:aws:iam::aws:policy/AWSCloudShellFullAccess\"]' THEN 'Group ' || title || ' has access to AWSCloudShellFullAccess.'
        ELSE 'Group ' || title || ' access to AWSCloudShellFullAccess is restricted.'
      END AS reason
    FROM
      aws_iam_group;
Severity: low
Tags: {}
Title: 1.22 Ensure access to AWSCloudShellFullAccess is restricted
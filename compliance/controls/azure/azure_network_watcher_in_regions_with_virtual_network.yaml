ID: azure_network_watcher_in_regions_with_virtual_network
Title: "Deploy network watcher when virtual networks are created"
Description: "This policy creates a network watcher resource in regions with virtual networks. You need to ensure existence of a resource group named networkWatcherRG, which will be used to deploy network watcher instances."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "select\n  a.id resource,\n  a.og_account_id as og_account_id,\n  a.og_resource_id as og_resource_id,\n  case\n    when b.region is null then 'alarm'\n    when lower(b.resource_group) = 'networkwatcherrg' then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when b.region is null then 'Network watcher does not exist in region' || a.region || '.'\n    when lower(b.resource_group) = 'networkwatcherrg' then b.name || ' exist in networkWatcherRG resource group.'\n    else b.name || ' does not exist in networkWatcherRG resource group.'\n  end as reason\n  \n  , a.resource_group as resource_group\n  , sub.display_name as subscription\nfrom\n  azure_virtual_network as a\n  left join azure_network_watcher as b on a.region = b.region\n  join azure_subscription sub on sub.subscription_id = a.subscription_id;\n"
  PrimaryTable: azure_virtual_network
  ListOfTables:
    - azure_network_watcher
    - azure_subscription
    - azure_virtual_network
  Parameters: []
Severity: medium
Tags:
  hipaa_hitrust_v92:
    - "true"
  service:
    - Azure/Network
Integration_Type_Name:
  - azure_subscription

ID: aws_iam_support_role
Title: "IAM Support Role"
Description: "Ensure there is an active IAM Support Role available within your AWS cloud account."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "with aws_support_access_roles as (\n  select \n    arn,\n    account_id \n  from \n    aws_iam_role \n  where \n    attached_policy_arns::text ilike '%arn:aws:iam::aws:policy/AWSSupportAccess%'\n)\n\nselect\n  a.account_id as resource,\n  a.og_account_id,\n  a.og_resource_id,\n  case\n    when r.arn is null then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when r.arn is null then 'there is no AWS Support Access role for this account'\n    else 'this account has AWS Support Access role'\n  end as reason,\n  a.region, \n  a.account_id\nfrom\n  aws_account as a\n  left join aws_support_access_roles as r on a.account_id = r.account_id\n"
  PrimaryTable: aws_account
  ListOfTables:
    - aws_account
    - aws_iam_role
    - aws_support_access_roles
  Parameters: []
Severity: high
Tags:
  platform_score_cloud_service_name:
    - AWS Identity and Access Management (IAM)
  platform_score_use_case:
    - Problem Identities
  score_service_name:
    - AWS Identity and Access Management (IAM)
  score_tags:
    - Problem Identities
Integration_Type_Name:
  - aws_cloud

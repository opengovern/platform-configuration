Description: Ensure the launch-wizard security group in your AWS account is not being used.
ID: aws_vpc_security_group_not_uses_launch_wizard_sg
IntegrationType:
  - aws_cloud_account
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables:
    - aws_ec2_network_interface
    - aws_vpc_security_group
  Parameters: []
  PrimaryTable: aws_vpc_security_group
  QueryToExecute: |
    WITH associated_sg AS (
      SELECT
        DISTINCT (sg ->> 'GroupName') AS sg_name
      FROM
        aws_ec2_network_interface,
        JSONB_ARRAY_ELEMENTS(groups) AS sg
      WHERE
        (sg ->> 'GroupName') LIKE 'launch-wizard%'
    )
    SELECT
      arn AS resource,
      s.og_account_id AS og_account_id,
      s.og_resource_id AS og_resource_id,
      CASE
        WHEN a.sg_name IS NULL THEN 'ok'
        ELSE 'alarm'
      END AS status,
      CASE
        WHEN a.sg_name IS NULL THEN title || ' not in use.'
        ELSE title || ' in use.'
      END AS reason
    FROM
      aws_vpc_security_group AS s
    LEFT JOIN associated_sg AS a
    ON a.sg_name = s.group_name
    WHERE
      group_name LIKE 'launch-wizard%';
Severity: low
Tags: {}
Title: VPC security groups should restrict uses of 'launch-wizard' security groups.
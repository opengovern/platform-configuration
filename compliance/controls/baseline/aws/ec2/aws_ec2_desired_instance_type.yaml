ID: aws_ec2_desired_instance_type
Title: "EC2 Instances types are Approved"
Description: "Ensure all EC2 instances are of a given instance type Optimal and Aligned with our Organization"
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "SELECT \n  instance_id as resource,\n  og_resource_id,\n  og_account_id,\n  CASE\n    WHEN '{{.awsAllowedInstanceTypes}}' = '' THEN 'ok'\n    WHEN '{{.awsAllowedInstanceTypes}}' LIKE '%' || instance_type || '%' THEN 'ok'\n    ELSE 'alarm'\n  END AS status,\n  CASE\n    WHEN '{{.awsAllowedInstanceTypes}}' = '' THEN 'allowed instance types not defined'\n    WHEN '{{.awsAllowedInstanceTypes}}' LIKE '%' || instance_type || '%' THEN instance_id || ' instance type is allowed by your organization' \n    ELSE instance_id || ' instance type is not allowed by your organization'\n  END AS reason,\n  region,\n  account_id\nFROM \n  aws_ec2_instance\n"
  PrimaryTable: aws_ec2_instance
  ListOfTables:
    - aws_ec2_instance
  Parameters:
    - Key: awsAllowedInstanceTypes
      Required: false
Severity: high
Tags:
  platform_score_cloud_service_name:
    - AWS EC2
  platform_score_use_case:
    - Over Utilization
  score_service_name:
    - AWS EC2
  score_tags:
    - Over Utilization
Integration_Type_Name:
  - aws_cloud

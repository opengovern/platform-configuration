Description: Allows users to query AWS Backup Frameworks and retrieve comprehensive
  data about each backup plan, including its unique ARN, version, creation and deletion
  dates, and more.
ID: aws_backup_framework_5
IntegrationTypeName:
- aws_cloud_account
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables: []
  Parameters: []
  PrimaryTable: null
  QueryToExecute: "select\n  rule_name,\n  compliance_result -> 'Compliance' ->> 'ComplianceType'\
    \ as compliance_type,\n  compliance_result -> 'Compliance' -> 'ComplianceContributorCount'\
    \ ->> 'CappedCount' as count_of_noncompliant_resources\nfrom\n  aws_config_rule\n\
    inner join\n(\n  -- The sub-query will create the AWS Config rule name from information\
    \ stored in the AWS Backup framework table.\n  select\n    case when framework_information.control_scope\
    \ = '' then concat(framework_information.control_name, '-', framework_information.framework_uuid)\n\
    \    else concat(upper(framework_information.control_scope), '-', framework_information.control_name,\
    \ '-', framework_information.framework_uuid)\n    end as rule_name\n  from\n \
    \ (\n    select\n      framework_name,\n      controls ->> 'ControlName' as control_name,\n\
    \      control_scope,\n      right(arn, 36) as framework_uuid\n    from\n    \
    \  aws_backup_framework,\n      jsonb_array_elements(framework_controls) as controls,\n\
    \      json_array_elements_text(coalesce(controls -> 'ControlScope' ->> 'ComplianceResourceTypes',\
    \ '[\"\"]')::json) as control_scope\n  ) as framework_information\n) as backup_framework\n\
    on\n  aws_config_rule.name = backup_framework.rule_name,\n  jsonb_array_elements(compliance_by_config_rule)\
    \ as compliance_result\nwhere\n  compliance_result -> 'Compliance' ->> 'ComplianceType'\
    \ = 'NON_COMPLIANT';"
Tags:
  cloud_asset_management:
  - 'true'
  cloud_provider:
  - aws
  cloud_service:
  - AWS Backup
Title: Find AWS Backup Frameworks and Compliance Types

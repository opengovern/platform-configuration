ID: aws_foundational_security_ssm_1
Title: "1 EC2 instances should be managed by AWS Systems Manager"
Description: "This control checks whether the EC2 instances in your account are managed by AWS Systems Manager. Systems Manager is an AWS service that you can use to view and control your AWS infrastructure. To help you to maintain security and compliance, Systems Manager scans your managed instances. A managed instance is a machine that is configured for use with Systems Manager. Systems Manager then reports or takes corrective action on any policy violations that it detects. Systems Manager also helps you to configure and maintain your managed instances."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "select\n  i.arn as resource,\n  i.og_account_id as og_account_id,\n  i.og_resource_id as og_resource_id,\n  case\n    when i.instance_state = 'stopped' then 'info'\n    when m.instance_id is null then 'alarm'\n    else 'ok'\n  end as status,\n  case\n    when i.instance_state = 'stopped' then i.title || ' is in stopped state.'\n    when m.instance_id is null then i.title || ' not managed by AWS SSM.'\n    else i.title || ' managed by AWS SSM.'\n  end as reason\n  \n  \nfrom\n  aws_ec2_instance i\n  left join aws_ssm_managed_instance m on m.instance_id = i.instance_id;"
  PrimaryTable: aws_ec2_instance
  ListOfTables:
    - aws_ec2_instance
    - aws_ssm_managed_instance
  Parameters: []
Severity: medium
Tags: {}
IntegrationType:
  - aws_cloud_account

ID: aws_cloudtrail_s3_object_write_events_audit_enabled
Title: "Ensure that Object-level logging for write events is enabled for S3 bucket"
Description: "This rule enables object-level logging for write events for S3 buckets. Object-level logging for write events helps in identifying the requestor who performed the write operation on the S3 bucket objects."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "with s3_selectors as\n(\n  select\n    name as trail_name,\n    is_multi_region_trail,\n    bucket_selector\n  from\n    aws_cloudtrail_trail,\n    jsonb_array_elements(event_selectors) as event_selector,\n    jsonb_array_elements(case jsonb_typeof(event_selector -> 'DataResources') \n    when 'array' then event_selector -> 'DataResources'\n    else '[]' end) as data_resource,\n    jsonb_array_elements(case jsonb_typeof(data_resource -> 'Values') \n    when 'array' then data_resource -> 'Values'\n    else '[]' end) as bucket_selector\n  where\n    is_multi_region_trail\n    and data_resource ->> 'Type' = 'AWS::S3::Object'\n    and event_selector ->> 'ReadWriteType' in\n    (\n      'WriteOnly',\n      'All'\n    )\n)\nselect\n  b.arn as resource,\n  og_account_id as og_account_id,\n  og_resource_id as og_resource_id,\n  case\n    when count(bucket_selector) > 0 then 'ok'\n    else 'alarm'\n  end as status,\n  case\n    when count(bucket_selector) > 0 then b.name || ' object-level write events logging enabled.'\n    else b.name || ' object-level write events logging disabled.'\n  end as reason\n  \n  , region, account_id\nfrom\n  aws_s3_bucket as b\n  left join\n    s3_selectors\n    on bucket_selector::json::text like ('%' || b.arn || '%')\n    or bucket_selector::json::text = '\"arn:aws:s3\"'\ngroup by\n  b.og_account_id, b.og_resource_id, b.account_id, b.region, b.arn, b.name, b.tags, b._ctx;\n"
  PrimaryTable: aws_s3_bucket
  ListOfTables:
    - aws_cloudtrail_trail
    - aws_s3_bucket
  Parameters: []
Severity: high
Tags:
  category:
    - Compliance
  cis:
    - "true"
  cis_item_id:
    - "3.10"
  cis_level:
    - "2"
  cis_section_id:
    - "3"
  cis_type:
    - automated
  cis_version:
    - v1.3.0
  plugin:
    - aws
  service:
    - AWS/S3
IntegrationType:
  - aws_cloud_account

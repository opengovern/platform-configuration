ID: aws_ec2_instances_with_multiple_elastic_network_interfaces
Title: "EC2 Instances with Multiple Elastic Network Interfaces"
Description: "Ensure that Amazon EC2 instances are not using multiple ENIs."
Query:
  Engine: CloudQL-v0.0.1
  QueryToExecute: "with instance_nis as (\n  select\n  i.instance_id, count(ni)\n  from\n  aws_ec2_instance as i,\n  jsonb_array_elements(network_interfaces) as ni\n  where ni -> 'Attachment' ->> 'Status' = 'attached'\n  group by i.instance_id\n  )\n  \n  select\n  i.instance_id as resource,\n  og_resource_id,\n  og_account_id,\n  case\n  when nis.count > 1 then 'alarm'\n  else 'ok'\n  end status,\n  case\n  when nis.count > 1 then i.instance_id || ' Has more than one network interfaces.'\n  else i.instance_id || ' Has more than one network interfaces.'\n  end as reason,\n  region,\n  account_id\n  from\n  aws_ec2_instance as i left join\n  instance_nis as nis on i.instance_id = nis.instance_id\n"
  PrimaryTable: aws_ec2_instance
  ListOfTables:
    - aws_ec2_instance
  Parameters: []
Severity: high
Tags:
  platform_score_cloud_service_name:
    - AWS EC2
  score_service_name:
    - AWS EC2
Integration_Type_Name:
  - aws_cloud

Description: Application Insights within Azure act as an Application Performance Monitoring solution providing valuable data into how well an application performs and additional information when performing incident response. The types of log data collected include application metrics, telemetry data, and application trace logging data providing organizations with detailed information about application activity and application transactions.
ID: azure_cis_v210_5_3_1
IntegrationType:
  - azure_subscription
Query:
  Engine: CloudQL-v0.0.1
  ListOfTables:
    - azure_subscription
    - azure_application_insight
  Parameters: []
  PrimaryTable: azure_subscription
  QueryToExecute: |
    WITH application_insights AS (
      SELECT
        subscription_id,
        COUNT(*) AS no_application_insight
      FROM
        azure_application_insight
      GROUP BY
        subscription_id
    )
    SELECT
      sub.id AS resource,
      sub.og_account_id AS og_account_id,
      sub.og_resource_id AS og_resource_id,
      CASE
        WHEN i.subscription_id IS NULL THEN 'alarm'
        ELSE 'ok'
      END AS status,
      CASE
        WHEN i.subscription_id IS NULL THEN sub.display_name || ' does not have application insights configured.'
        ELSE sub.display_name || ' has ' || no_application_insight || ' application insights configured.'
      END AS reason
    FROM
      azure_subscription AS sub
    LEFT JOIN application_insights AS i 
      ON i.subscription_id = sub.subscription_id;
Severity: low
Tags: {}
Title: 5.3.1 Ensure Application Insights are Configured